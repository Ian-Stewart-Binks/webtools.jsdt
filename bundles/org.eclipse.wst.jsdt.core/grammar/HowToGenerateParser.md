How to Generate the JS Parser
--------------------------------

## Where to get the parser generator ##

The parser files and resources are automatically generated using the Jikespg parser generator. This tools has been renamed Jikes Parser generator. 
You can find more information and latest releases at this link. The latest tool is provided in source format.
 We don't provide any help for compiling these source files. Refer to the link above if you have trouble to get binaries.
Our grammar is generated using the version 1.3 of [Jikespg](https://www.eclipse.org/jdt/core/howto/generate%20parser/jikespg.exe)

## Where to get the grammar

The latest grammar is always located in the js.g file. Go to the org.eclipse.wsdt.jsdt.core plugin's directory (eclipse\plugins\org.eclipse.wsdt.jsdt.core where eclipse 
is the root of your eclipse installation) and open the grammar directory. Then search for the js.g file inside the folder grammar. Then copy its contents from:

    --main options
    %options ACTION, AN=JavaAction.java, GP=java, 
    ....
    $end
    -- need a carriage return after the $end

into a file called js.g. It is important to add a carriage return at the end of the last line. You can save this file where you want,
we will assume from thereon you saved it in d:\temp\. If the end-of-line of the environment of the C compiler used to build jikespg 
is different from the one used when running the executable, you might end up with an exception at runtime.
Be sure to used consistent end-of-line characters. 


## What to do with these files and update the parser class...

Assuming the Jikespg executable (jikespg.exe) is located in d:\jikespg. 

1.First in a terminal, run:

    d:
    cd \temp
    d:\jikespg\jikespg.exe js.g

2.If everything goes well, this creates some java source files and information files in the current directory. 
 
* **java.l :**  Information generated by jikespg. Enumarate all the states created for the automaton, etc.
* **JavaAction.java :** Contains the method `org.eclipse.wst.jsdt.internal.compiler.parser.Parser#consumeRule(int)`, which handles all semantic action dispatches.
* **javahdr.java :**  Used to generate the resources files.
* **javadcl.java :**  Used to generate the resources files.
* **javasym.java :**  Contents of the class org.eclipse.jdt.core.compiler.TerminalTokens.
* **javadef.java :**  Contents of the class org.eclipse.jdt.internal.compiler.parser.ParserBasicInformation.
* **javaprs.java :**  You don't need this file. Its contents is already inlined in the Parser class.

3.Now we need to update the different classes and resource files. 

1. Copy the contents of the JavaAction.java file into the `consumeRule(int)` method of the `org.eclipse.wst.jsdt.internal.compiler.parser.Parser` class.
2. The class `org.eclipse.wst.jsdt.internal.compiler.parser.ParserBasicInformation` needs to be updated with the content of the file **javadef.java**. Don't copy the interface name. Simply copy the field declarations. The actual source of this class will guide you.
3. Similarly, update the class `org.eclipse.wst.jsdt.internal.compiler.parser.TerminalTokens` with the contents of the file **javasym.java**.
4. The last step is to update the resource files: Copy a compiled copy of 'org.eclipse.wst.jsdt.core inside d:\temp. You will have a file `UpdateParserFiles.class`. Then run the following command-line:

     D:\temp>java -classpath jsdtcore.jar:. UpdateParserFiles javadcl.java javahdr.java
Once this done, you will end up with 25 new files inside d:\temp. They are called *parser<n>.rsc*, with n equals to 1..24 and *readableNames.properties*. All these files need to be moved to the org\eclipse\wst\jsdt\internal\compiler\parser folder. Now you are ready to execute and test the new parser.


